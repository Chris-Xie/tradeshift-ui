!function(window){"use strict";ts.dox=gui.namespace("ts.dox",function(){function getmagicurl(foldername,filename){return foldername=foldername.replace(/\/+/g,"/"),foldername=foldername.split("/docs/dist/")[1],foldername+filename}function hasrelevant(tabs){return tabs.filter(visibletab).length>1}function visibletab(tab){return tab[2]!==!0||islocalhost}function createtab(tab,file,fold,indx,hide){var label=tab[0],href=tab[1],icon=hide?"ts-icon-locked":null,magicurl=getmagicurl(fold,href),selected=href===file||indx&&"index.html"===href;return new Tab(label,icon,magicurl,selected)}function Tab(label,icon,href,selected){this.icon=icon,this.label=label,this.selected=selected,this.onselect=function(){selected||(top.location.hash=href)}}var islocalhost="10114"===location.port;return{booting:!0,tabs:function(tabs){var path=location.pathname,file=path.substring(path.lastIndexOf("/")+1),fold=path.replace(file,""),indx=""===file;hasrelevant(tabs)&&ts.ui.TopBar.tabs(tabs.filter(visibletab).map(function(tab){return createtab(tab,file,fold,indx,tab[2]===!0)}))}}}()),ts.dox.ItemModel=ts.ui.Model.extend({label:null,icon:null,hidden:!1,open:!1,selected:!1}),ts.dox.ItemModel.prototype.items=ts.ui.Collection.extend({$of:ts.dox.ItemModel}),ts.dox.MenuModel=ts.dox.ItemModel.extend()}(self),function(window){"use strict";ts.dox.ChromeSpirit=function(CSSPlugin,Then){var BP_TABLET=600,SIDEBAR_MACRO=320,GLOBALTITLE="Tradeshift UI",MENUOPEN="action-open-menu",MENUCLOSE="action-close-menu",ONDOM=ts.ui.ACTION_FRAME_ONDOM,DOLOAD=ts.ui.ACTION_GLOBAL_LOAD,ONRESIZE=gui.BROADCAST_RESIZE_END,MENUON=ts.ui.BROADCAST_GLOBAL_MENU_OPEN,TITLE=ts.ui.ACTION_GLOBAL_DOCUMENT_TITLE,ONROTATE=gui.BROADCAST_ORIENTATIONCHANGE,LOADING=ts.ui.BROADCAST_GLOBAL_APP_LOADING,COMPLETE=(ts.ui.BROADCAST_GLOBAL_APP_ABORTED,ts.ui.BROADCAST_GLOBAL_APP_COMPLETE),ASIDESON=ts.ui.BROADCAST_GLOBAL_ASIDES_WILL_ON,ASIDESOFF=ts.ui.BROADCAST_GLOBAL_ASIDES_WILL_OFF,DIALOGSON=ts.ui.BROADCAST_GLOBAL_DIALOGS_WILL_BLOCK,DIALOGSOFF=ts.ui.BROADCAST_GLOBAL_DIALOGS_DID_UNBLOCK;return ts.ui.Spirit.extend({onready:function(){ts.ui.Spirit.prototype.onready.call(this),this._sbar=this.dom.q(".ts-sidebar",ts.ui.SideBarSpirit),this._menu=this.dom.q(".ts-menu",ts.dox.MenuSpirit),this._main=this.dom.q(".ts-main",ts.ui.MainSpirit),this._menu.life.add(gui.LIFE_RENDER,this),this.event.add("hashchange",window),this.event.add("transitionend",this._main),this.action.add([ONDOM,MENUOPEN,MENUCLOSE]).addGlobal([TITLE,DOLOAD]),this.broadcast.addGlobal([TITLE,MENUON,ONROTATE,ASIDESON,ASIDESOFF,DIALOGSON,DIALOGSOFF]).add(ONRESIZE),location.hash.length>1?this._onhashchange(location.hash):location.hash="intro/",this._layout(window.innerWidth)},onlife:function(l){ts.ui.Spirit.prototype.onlife.call(this,l);var first=".ts-doxmenu > .ts-checked:first-child";l.type===gui.LIFE_RENDER&&(this.css.shift(this.dom.q(first),"intropage"),this.css.contains("ts-menudone")||this.reflex(function(){this.css.add("ts-menudone")},this))},onaction:function(a){switch(ts.ui.Spirit.prototype.onaction.call(this,a),a.type){case TITLE:this._title(a.data);break;case MENUOPEN:this._openmenu(!0);break;case MENUCLOSE:this._openmenu(!1);break;case DOLOAD:this._sethashfromhref(a.data.href),a.consume();break;case ONDOM:ts.dox.booting?(this._firstload(),ts.dox.booting=!1):this._nextload()}},onbroadcast:function(b){switch(ts.ui.Spirit.prototype.onbroadcast.call(this,b),b.type){case MENUON:this._iscollapsed()&&this._openmenu(!0);break;case ONRESIZE:case ONROTATE:this._layout(window.innerWidth);break;case ASIDESON:this._cover("ts-asidecover").fadeIn();break;case ASIDESOFF:this._cover("ts-asidecover").fadeOut();break;case DIALOGSON:this._cover("ts-dialogcover").fadeIn();break;case DIALOGSOFF:this._cover("ts-dialogcover").fadeOut()}},onevent:function(e){switch(ts.ui.Spirit.prototype.onevent.call(this,e),e.type){case"transitionend":this._thenclosed&&(this._thenclosed.now(),this._thenclosed=null);break;case"hashchange":this._onhashchange(location.hash)}},onkey:function(k){ts.ui.Spirit.prototype.onkey.call(this,k),k.down&&"Esc"===k.type&&this._openmenu(!1)},_sbar:null,_menu:null,_main:null,_thenclosed:null,_sethashfromhref:function(href){var hash=href.split("#")[1];hash&&(location.hash=hash)},_onhashchange:function(hash){if(hash.length>1){var path=hash.substring(1);this._menu.selectbestitem(path).then(function(){this.tick.time(function(){this._loadnext(path)},this._isopenmenu()?300:0)},this)}},_firstload:function(){this._openmenu(!1),this._showloading(!1),this.tick.time(function(){ts.ui.get(document.documentElement).reflex()})},_nextload:function(){this.tick.time(function(){this._openmenu(!1),this._showloading(!1),this._oldframe&&(this._oldframe.dom.remove(),this._oldframe=null)},50)},_loadnext:function(path){if(this._showloading(!0),this._isopenmenu())this._openmenu(!1),this._thenclosed=new Then(function(){this._loadnext(path)},this);else{var href="dist/"+path,oldf=this.dom.qdoc("iframe",ts.ui.FrameSpirit),newf=ts.ui.FrameSpirit.summon(href);this._main.dom.append(newf),this._oldframe=oldf||null}},_layout:function(width){var some="collapse-some",full="collapse-full",mobile=width<=BP_TABLET,tablet=width>BP_TABLET&&width<BP_TABLET+SIDEBAR_MACRO,desktop=!mobile&&!tablet;this._sbar.isOpen=desktop,this._sbar._closebutton(!desktop),mobile?this.css.remove(some).add(full):tablet?this.css.remove(full).add(some):this.css.remove(some).remove(full)},_openmenu:function(uncollapse){this.css.shift(uncollapse,"uncollapse"),this.key.shift(uncollapse,"Esc"),this._sbar.open(uncollapse),this._sbar.onclose=uncollapse?function(){this._openmenu(!1)}.bind(this):null},_isopenmenu:function(){return this.css.contains("uncollapse")},_iscollapsed:function(){return["collapse-some","collapse-full"].some(function(name){return this.css.contains(name)},this)},_showloading:function(loading){this.broadcast.dispatchGlobal(loading?LOADING:COMPLETE)},_cover:function(id){return ts.ui.CoverSpirit.getCover(id)},_title:function(title){title===GLOBALTITLE?document.title=GLOBALTITLE:document.title=title+" â€” "+GLOBALTITLE}})}(gui.CSSPlugin,gui.Then),ts.dox.MenuSpirit=function(isInView,goIntoView){return ts.ui.Spirit.extend({onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.css.add("ts-menu"),this.event.add("hashchange",window),this._loadmenu(this.dom.q("script"))},onrender:function(summary){ts.ui.Spirit.prototype.onrender.call(this,summary),this._newselection&&(this._revealchecked(this.dom.q(".ts-checked")),this._newselection=!1)},selectbestitem:function(path){function folder(full){return full.replace(/[^\/]*$/,"")}path=folder(path);var then=new gui.Then,that=this,open=null;return function loop(items,container){items.filter(function(item){return!item.hidden}).forEach(function(item){if(item.path){var match=folder(item.path)===path,state=item.selected;(item.selected=match)&&(match!==state&&(that._newselection=!0),container?(container.open=!0,open=container):item.items?item.open||(that._onsubmenu(item,then),open=item):that._onnormal(item,then))}item.items&&loop(item.items,item)})}(this._model.items),this._open=open||this._open,this._then||then.now()},ontween:function(t){ts.ui.Spirit.prototype.ontween.call(this,t),"doxmenu"===t.type&&t.done&&(this._next?(this._next.open=!0,this._next=null):(this.tween.remove(t.type),this._then&&(this._then.now(),this._then=null)))},_model:null,_then:null,_loadmenu:function(script){this._model=new ts.dox.MenuModel({items:JSON.parse(script.textContent.trim())}),this.script.load(ts.dox.MenuSpirit.edbml),this.script.input(this._model)},_revealchecked:function(checked){checked&&!isInView(checked)&&goIntoView(checked)},_onsubmenu:function(item,then){this.life.async?(this.tween.add("doxmenu"),this._then=then,this._open?(this._next=item,this._open.open=!1):item.open=!0):(item.open=!0,then.now())},_onnormal:function(item,then){console.log("NORMAL"),this.life.async&&this._open?(this.tween.add("doxmenu"),this._open.open=!1,this._then=then,this._open=null):then.now()}})}(function(el){var rect=el.getBoundingClientRect();return rect.top>=0&&rect.bottom<=window.innerHeight},function(el){el.scrollIntoView(!1)}),ts.dox.ItemSpirit=function(){return ts.ui.Spirit.extend({delta:function(delta){this.tween.add("doxmenu"),this._delta=delta},ontween:function(t){ts.ui.Spirit.prototype.ontween.call(this,t),"doxmenu"===t.type&&(t.done?(this.tween.remove("doxmenu"),this.sprite.reset(),this._delta=0):this._delta>0?this.sprite.y=this._delta*t.value:this.sprite.y=Math.abs(this._delta)*(1-t.value))},_delta:0})}(),ts.dox.MenuCoverSpirit=function(){return ts.dox.ItemSpirit.extend({onasync:function(){ts.dox.ItemSpirit.prototype.onasync.call(this),gui.Client.isWebKit?this.css.left=-5:this.css.left=0-gui.Client.scrollBarSize},ontween:function(t){ts.dox.ItemSpirit.prototype.ontween.call(this,t),"doxmenu"===t.type&&(t.init?this.css.height=window.innerHeight:t.done&&(this.css.height=0))}})}(),ts.dox.SubMenuSpirit=function(ItemSpirit,MenuCoverSpirit,Client){return ItemSpirit.extend({open:function(open){open!==this._open&&(this._open=open,Client.hasTransitions&&!ts.dox.booting?(this._sliding=!0,this.css.add("sliding"),this.tween.add("doxmenu"),this._tweenstart(this.dom.q("menu"),open)):this.css.shift(open,"open"))},ontween:function(t){ItemSpirit.prototype.ontween.call(this,t),this._sliding&&"doxmenu"===t.type&&(t.init?this._open||this.css.remove("open"):t.done&&(this._sliding=!1,this.tween.remove("doxmenu"),this.css.remove("sliding"),this._open&&this.css.add("open")))},_open:!1,_sliding:!1,_tweenstart:function(menu,open){var delta=menu.offsetHeight*(open?1:-1),other=this.dom.following(ItemSpirit),cover=this.dom.qdoc("#menucover",MenuCoverSpirit);other.concat([cover]).forEach(function(item,index){item.delta(delta)});var last=(other.pop()||this).element,rect=last.getBoundingClientRect();cover.css.top=rect.bottom,this.tween.dispatch("doxmenu",{duration:ts.ui.TRANSITION_FAST,timing:"ease-out"})}})}(ts.dox.ItemSpirit,ts.dox.MenuCoverSpirit,gui.Client),ts.dox.PrismSpirit=ts.ui.Spirit.extend({code:"",onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.code=decodeURIComponent(this.code),this._parseinput(this.dom.q("input[type=hidden]"))},_parseinput:function(input){input&&this._parseconfig(JSON.parse(decodeURIComponent(input.value)))},_parseconfig:function(config){config.show&&(this._toolbar=this.dom.prepend(ts.ui.ToolBarSpirit.summon()),this._toolbar.css.add("ts-micro"),this._toolbar.uncompact())}}),ts.dox.MarkupSpirit=ts.dox.PrismSpirit.extend({onenter:function(){ts.dox.PrismSpirit.prototype.onenter.call(this),this.dom.q(".output")&&this._initialize(this.dom.q(".tabpanels"),this.dom.qall(".tabpanels > *"))},_parseconfig:function(config){ts.dox.PrismSpirit.prototype._parseconfig.call(this,config);var flip=config.flip,that=this;if(config.outs){var tabs=[{label:"Markup",selected:!config.flip,onselect:function(){that._togglepanels(flip?0:1,flip?1:0)}},{label:"Render",selected:config.flip,onselect:function(){that._togglepanels(flip?1:0,flip?0:1)}}];flip&&tabs.reverse(),this._toolbar.tabs(tabs),this._toolbar.script.run()}},_initialize:function(parent,panels){parent.style.minHeight=panels.reduce(function(max,panel,index){var height=panel.offsetHeight;return panel.style.display=index>0?"none":"block",height>max?height:max},0)+"px"},_togglepanels:function(oldindex,newindex){var panels=this.dom.qall(".tabpanels > *");panels[oldindex].style.display="none",panels[newindex].style.display="block"}}),ts.dox.JavaScriptSpirit=ts.dox.PrismSpirit.extend({onevent:function(e){var elm=e.target,prism=this.dom.q(".prism");"click"===e.type&&prism&&!this._editor&&(prism===elm||gui.DOMPlugin.contains(prism,e.target))&&this._edit()},_editor:null,_parseconfig:function(config){if(ts.dox.PrismSpirit.prototype._parseconfig.call(this,config),config.runs){var classed=this.css.contains("attention"),primary=this._attention(classed),that=(this._toolbar.buttons(),this);this._toolbar.buttons().push({type:primary?"ts-primary":"ts-tertiary",label:"Run This Code",onclick:function(){that.css.remove("attention"),that._run()}}),this._toolbar.buttons().push({visible:!1,label:"Revert",id:"button-revert",onclick:function(){that._editor.dom.remove(),that._editor=null,this.hide()}}),this._toolbar.script.run(),this.event.add("click")}},_run:function(){try{new Function(this._editor?this._editor.value:this.code)()}catch(exception){console.error(exception.message),this._editor?ts.ui.Notification.error(exception.message):ts.ui.Notification.warning(["Script error! Sometimes a snippet depends on a previous ","snippet. If there are other snippets on the page, try ","running them in a different order."].join(""),"Alrighty")}},_edit:function(){var area=this._editor=ts.ui.TextAreaSpirit.summon(),pane=this.dom.q(".tabpanels");area.css.add("editcode"),area.value=this.code,this._makeeditor(area),area.dom.appendTo(pane),area.focus(),area.element.setSelectionRange(0,0)},_attention:function(yes){return yes&&this.dom.append(gui.HTMLParser.parseToNode(['<div class="message">',"<p>",'<i class="ts-icon-arrowleft"></i>',"<strong>Interactive time</strong><br/>","Please <code>Run this code</code>","</p>","</div>"].join("\n"))),yes},_makeeditor:function(area){var value=area.value,buttons=this._toolbar.buttons();$(area.element).keypress(function(e){if(9==e.keyCode){var myValue="\t",startPos=this.selectionStart,endPos=this.selectionEnd,scrollTop=this.scrollTop;this.value=this.value.substring(0,startPos)+myValue+this.value.substring(endPos,this.value.length),this.focus(),this.selectionStart=startPos+myValue.length,this.selectionEnd=startPos+myValue.length,this.scrollTop=scrollTop,e.preventDefault()}}).keyup(function(){null!==value&&area.value!==value&&buttons.get("button-revert").show()})}}),ts.dox.ApiTableSpirit=function(Type,GuiObject,GuiArray,Markdown){function minimalmarkdown(object){return GuiObject.each(object,function(key,value){return parsemarkdown(object,key,value)}).forEach(function(nestedobject){minimalmarkdown(nestedobject)}),object}function parsemarkdown(object,key,value){var code=/`(.*)`/g;return Type.isComplex(value)?value:void("desc"===key?object[key]=Markdown.parse(value):Type.isString(value)&&(object[key]=value.replace(code,"<code>$1</code>")))}return ts.ui.Spirit.extend({code:null,onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.code&&(this.script.load(ts.dox.ApiTableSpirit.edbml),this.script.run(minimalmarkdown(this.code)))}})}(gui.Type,gui.Object,gui.Array,ts.ui.Markdown),gui.module("dox-gui@tradeshift.com",{channel:[["[data-ts=DoxChrome]",ts.dox.ChromeSpirit],["[data-ts=DoxMenu]",ts.dox.MenuSpirit],["[data-ts=DoxItem]",ts.dox.ItemSpirit],["[data-ts=DoxSubMenu]",ts.dox.SubMenuSpirit],["[data-ts=DoxMenuCover]",ts.dox.MenuCoverSpirit],["[data-ts=DoxMarkup]",ts.dox.MarkupSpirit],["[data-ts=DoxScript]",ts.dox.JavaScriptSpirit],["[data-ts=DoxApi]",ts.dox.ApiTableSpirit]],oncontextinitialize:function(){gui.attributes.push("docs"),window!==top&&this._sectionclassname(location.href)},_sectionclassname:function(href){var rest=href.split("/dist/")[1],root=document.documentElement;rest&&rest.length&&gui.CSSPlugin.add(root,rest.split("/")[0])}})}(self),edbml.declare("ts.dox.ApiTableSpirit.edbml").as(function $edbml(api){"use strict";function renderCaption(name){out.html+="<caption><code>"+$txt(name)+"</code></caption>"}function renderProps(props){out.html+='<tbody><tr><th>Property</th><th colspan="2">Type</th></tr>',props.forEach(function(prop){out.html+="<tr><td><code>"+$txt(prop.name||"")+"</code></td><td>",format(prop.type),out.html+="</td>",$att["class"]=prop.todo?"todo":null,out.html+="<td "+$att.$("class")+">"+prop.desc+"</td></tr>"}),out.html+="</tbody>"}function renderMethods(methods){out.html+='<tbody><tr><th>Method</th><th colspan="2">',methods.some(hasparams)&&(out.html+="<span>Params</span>"),out.html+="</th></tr>",methods.forEach(function(method){out.html+="<tr><td><code>"+$txt(method.name||"")+"</code></td><td>",format(method.args),out.html+="</td><td>"+returntype(method.type,method.desc)+"</td></tr>"}),out.html+="</tbody>"}function hasparams(method){return method.args&&method.args.length}function format(args){args&&args.length&&!Array.isArray(args)&&(args=[args]),args=args||[];var ends=args.length-1;args.forEach(function(type,i){type.startsWith("(")?out.html+="<code>"+$txt(type)+"</code>":out.html+="<code>{"+$txt(type)+"}</code>",i<ends&&(out.html+="<br/>")})}function returntype(type,desc){if(type){var fix=!desc.trimRight().endsWith(".");return desc+=fix?".":"",desc+" Returns {<code>"+type+"</code>}"}return desc}var out=$edbml.$out,$att=$edbml.$att,$txt=edbml.safetext;return out.html+='<table class="api">',api.name&&renderCaption(api.name),api.properties&&renderProps(api.properties),api.methods&&renderMethods(api.methods),out.html+="</table>",out.write()}),edbml.declare("ts.dox.MenuSpirit.BACKUP.edbml").as(function $edbml(){"use strict";function renderItems(items){items.filter(function(item){return!item.hidden}).forEach(renderItem)}function renderItem(item){if($att.id=item.$instanceid,item.path)$att["class"]=item.selected?"ts-checked":null,out.html+="<li "+$att.$("id")+" "+$att.$("class")+' data-ts="DoxItem"><a href="#'+$val(item.path)+'" tabindex="-1"><i data-ts="Icon" class="'+$val(item.icon)+'"></i><span>'+$txt(item.label)+"</span></a></li>";else if(item.items){out.html+="<li "+$att.$("id")+' class="submenu" data-ts="DoxSubMenu" data-ts.open="'+$val(item.open)+'">';var $1=$set(function(){item.open=!item.open},this);out.html+="<button onclick=\"edbml.$run(this, '"+$1+'\');" tabindex="-1"><i data-ts="Icon" class="'+$val(item.icon)+'"></i><span>'+$txt(item.label)+'</span></button><div class="ts-shadow"></div><menu class="ts-menu">',renderItems(item.items),out.html+="</menu></li>"}else item.label&&(out.html+='<h3><div class="ts-shadow"></div><span>'+$txt(item.label)+"</span></h3>")}var out=$edbml.$out,$att=$edbml.$att,$set=edbml.$set,$txt=edbml.safetext,$val=edbml.safeattr,menu=$edbml.$input(ts.dox.MenuModel);return renderItems(menu.items),out.write()}).withInstructions([{input:{name:"menu",type:"ts.dox.MenuModel"}}]),edbml.declare("ts.dox.MenuSpirit.edbml").as(function $edbml(){"use strict";function renderItems(items){items.filter(function(item){return!item.hidden}).forEach(renderItem)}function renderItem(item){$att.id="item-"+item.$instanceid,item.items?(out.html+="<li "+$att.$("id")+' class="submenu" data-ts="DoxSubMenu" data-ts.open="'+$val(item.open)+'">',renderLink(item),out.html+='<div class="ts-shadow"></div><menu class="ts-menu">',renderItems(item.items),out.html+="</menu></li>"):item.path?(out.html+="<li "+$att.$("id")+' data-ts="DoxItem">',renderLink(item),out.html+="</li>"):item.label&&(out.html+='<h3 id="'+$val(itemid)+'"><div class="ts-shadow"></div><span>'+$txt(item.label)+"</span></h3>")}function renderLink(item){$att.href="#"+item.path,$att.id="link-"+item.$instanceid,$att["class"]=item.selected?"ts-checked":null,out.html+="<a "+$att.$("id")+" "+$att.$("class")+" "+$att.$("href")+' tabindex="-1"><i data-ts="Icon" class="'+$val(item.icon)+'"></i><span>'+$txt(item.label)+"</span></a>"}var out=$edbml.$out,$att=$edbml.$att,$txt=edbml.safetext,$val=edbml.safeattr,menu=$edbml.$input(ts.dox.MenuModel);return renderItems(menu.items),ts.dox.MenuCoverSpirit,out.write()}).withInstructions([{input:{name:"menu",type:"ts.dox.MenuModel"}}]);
//# sourceMappingURL=dox.min.js.map